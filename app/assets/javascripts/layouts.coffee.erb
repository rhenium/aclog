$ ->
  vm = new Vue
    el: "#user-jump-dropdown"
    data:
      users: []
      enteredUserName: ""
      loading: false
    methods:
      failProfileImage: (e) ->
        e.target.src = '<%= image_path("profile_image_missing.png") %>'
      focus: ->
        setTimeout (-> $("#user-jump-dropdown input").focus()), 0
      submit: (e) ->
        e.preventDefault()
        window.location = "/" + this.enteredUserName

  currentReq = null
  vm.$watch "enteredUserName", (newVal, oldVal) ->
    if newVal.length > 0 && newVal != oldVal
      if vm.loading
        currentReq.abort()
      vm.users = []
      vm.loading = true
      currentReq =
        superagent
          .get "/i/api/users/suggest_screen_name?head=" + encodeURIComponent(newVal)
          .accept "json"
          .end (err, res) ->
            vm.users = res.body
            vm.loading = false
