//= require jquery
//= require jquery_ujs
//= require bootstrap
//= require _widgets
//= require _define_application
//= require_tree .

$(function() {
    // Layout: User jump
    $("#jump_to_dropdown_toggle").click(function() {
        setTimeout(function() { $("#jump_to_textbox").focus(); }, 0);
    });

    var previous_jump_to_text;
    $("#jump_to_textbox").on("keyup", function() {
        if ($(this).val() != previous_jump_to_text) {
            previous_jump_to_text = $(this).val();
            $("#jump_to_user .jump_to_user_suggestion").remove();
            if ($(this).val().length > 0) {
                $.getJSON("/i/user_jump_suggest.json", { head: $(this).val() }, function(json) {
                    json.forEach(function(s) {
                        $("#jump_to_user").append($("<li />").addClass("jump_to_user_suggestion")
                            .append($("<a />").attr("href", "/" + s.screen_name).attr("title", s.name + " (@" + s.screen_name + ")")
                                .append($("<img />").addClass("twitter-icon").attr("src", s.profile_image_url).attr("alt", "@" + s.screen_name).attr("onerror", "this.src = '<%= image_path("profile_image_missing.png") %>'"))
                                .append($("<span />").text("@" + s.screen_name))));
                    });
                });
            }
        }
    });
    $("#jump_to_form").on("submit", function() {
        $(this).attr("action", "/" + $("#jump_to_textbox").val());
    });
});

$(function() {
    var controller = $("body").data("controller");
    var action = $("body").data("action");

    var ac = Application[controller];
    if (ac !== undefined) {
        if (ac["_"] !== undefined) { ac["_"](); }
        if (ac[action] !== undefined) { ac[action](); }
    }
});

